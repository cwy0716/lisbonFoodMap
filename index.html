<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>里斯本吃喝地图</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
  body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  }

  #container {
    display: flex;
    height: 100vh;
  }

  /* 左侧地图 */
  #map {
    flex: 1;
    height: 100%;
  }

  /* 右侧列表 */
  #sidebar {
    width: 280px;
    background: #ffffff;
    border-left: 1px solid #ddd;
    overflow-y: auto;
    padding: 12px;
  }

  #categoryBar {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 12px;
  }

  .cat-btn {
    padding: 6px 14px;
    border-radius: 20px;
    border: 1px solid #aaa;
    background: #f5f5f5;
    cursor: pointer;
    font-size: 14px;
  }

  .cat-btn.active {
    background: #007bff;
    color: #fff;
    border-color: #007bff;
  }

  .shop-item {
    padding: 10px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
  }

  .shop-item:hover {
    background: #f0f8ff;
  }

  .shop-name {
    font-size: 16px;
    font-weight: bold;
  }

  /* Marker: 圆形图 */
  .custom-marker {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    overflow: hidden;
    border: 3px solid white;
    box-shadow: 0 0 6px rgba(0,0,0,0.25);
  }
  .custom-marker img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Popup 卡片 */
  .popup-card {
    width: 240px;
  }
  .popup-img {
    width: 100%;
    height: 140px;
    border-radius: 8px;
    object-fit: cover;
  }
  .popup-title {
    font-size: 18px;
    font-weight: bold;
    margin: 6px 0;
  }
  .popup-address .popup-cost {
    font-size: 14px;
    color: #444;
  }
  .popup-desc {
    font-size: 14px;
    color: #444;
    margin-top: 6px;
  }

  /* 手机模式：右侧栏下移 */
  @media (max-width: 750px) {
    #container {
      flex-direction: column;
    }
    #sidebar {
      width: 100%;
      height: 40%;
      border-left: none;
      border-top: 1px solid #ddd;
    }
    #map {
      height: 60%;
    }
  }
</style>
</head>

<body>
<div id="container">
  <div id="map"></div>

  <div id="sidebar">
    <div id="categoryBar"></div>
    <div id="shopList"></div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* ========= 地图初始化 ========= */
var map = L.map("map").setView([38.7368, -9.1424], 13);
L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 19
}).addTo(map);

/* ========= 餐厅数据（多分类支持） ========= */
const shops = [
  {
    name: "Sakura",
    lat: 38.76804563521522,
    lng: -9.092140376049445,
    categories: ["日料", "自助"],
    cost: "午餐16.9€ 晚餐22.9€",
    address: "Passeio das Tágides 2.25, 1990-221 Lisboa",
    desc: "经常去的店，环境不错，品类挺多的，甜虾有点腥。",
    img: "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/2d/e4/55/b2/caption.jpg?w=900&h=500&s=1"
  },
  {
    name: "Ha Noi Xua",
    lat: 38.7359274102392,
    lng: -9.149589578721171,
    categories: ["越南"],
    cost: "15-20€",
    address: "Av. João Crisóstomo 47C, 1050-066 Lisboa",
    desc: "炸鸡翅一般，有鸭血的那个米粉肉超多。推荐炸豆腐和豆腐布丁，布丁奶味十足。",
    img: "https://tb-static.uber.com/prod/image-proc/processed_images/151dc3dbc3309ab24d654070491bcd33/30be7d11a3ed6f6183354d1933fbb6c7.jpeg"
  },
  {
    name: "Seoul K BBQ",
    lat: 38.738646818955196,
    lng: -9.150558922367713,
    categories: ["烤肉", "自助"],
    cost: "午餐16.95€ 晚餐18.95€",
    address: "Av. Elias Garcia 147A, 1050-102 Lisboa",
    desc: "便宜，菜品种类挺多的，但这个价格也别要求肉超优质了，反正我吃着挺好。有集点卡，吃九次送一次。",
    img: "https://media.timeout.com/images/106040559/image.webp"
  },
  {
    name: "Eat Thai",
    lat: 38.76327252017592,
    lng: -9.097865333500149,
    categories: ["泰餐"],
    cost: "谷歌人均15-20€，但我感觉还要贵一些",
    address: "Av. Mediterrâneo 6H, 1990-155 Lisboa",
    desc: "泰国人开的，很正宗，去了好多次了。</br> 猪皮脆脆的。生腌虾很新鲜，有点辣。甜品芒果糯米饭必点。可惜没有生腌三文鱼……</br> 烤猪肉不推荐，硬。",
    img: "https://cdn.thefork.com/tf-lab/image/upload/w_500,h_500,c_fill,q_auto,f_auto,g_auto:subject/restaurant/5f910d76-8da2-4dbc-aaeb-9f5399d25d6d/f6b251fb-33ce-4355-94f6-5163cfa33e00.jpg"
  },
  {
    name: "Han Table Barbecue",
    lat: 38.77013664524855,
    lng: -9.092501991172153,
    categories: ["烤肉"],
    cost: "",
    address: "R. da Pimenta 5, 1990-280 Lisboa",
    desc: "只堂食物过一次，谷歌评分挺高的。打包过几次炒年糕、泡菜、炒杂菜，好吃。",
    img: "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/2d/e8/70/8d/caption.jpg?w=1000&h=-1&s=1"
  },
  {
    name: "Friendship Korean BBQ",
    lat: 38.77116070923121, 
    lng: -9.095761594888865,
    categories: ["烤肉"],
    cost: "15-25€",
    address: "Alameda dos Oceanos 61A, 1990-208 Lisboa",
    desc: "聚会常去，便宜，好吃。",
    img: "https://scontent.flis5-3.fna.fbcdn.net/v/t51.75761-15/499133868_17982591860821941_9209076530450974233_n.jpg?stp=dst-jpegr_s1080x2048_tt6&_nc_cat=101&ccb=1-7&_nc_sid=127cfc&_nc_ohc=8qqZ4hDsBQQQ7kNvwH53Xcb&_nc_oc=AdmfxKGS1agUOgsKHLyBT6cKfBzS3B9KPYITIqLy-3Hq0V7ICF_lEtJ0sbVbC6xzkm27k7QyTusoRcCZ7a5Bedjk&_nc_zt=23&se=-1&_nc_ht=scontent.flis5-3.fna&_nc_gid=5MYxj2f0JEolsvh5FPAy-w&oh=00_AfijpJkude6tZGkUtXlWF-CdCuEkhtMekUrFw0-E6VIfcw&oe=6926D79F"
  },
  {
    name: "TOKYO BBQ HOUSE",
    lat: 38.767663684235806, 
    lng: -9.0924139441435,
    categories: ["烤肉", "自助"],
    cost: "午餐21.9€ 晚餐23.9€",
    address: "lisboa Passeio das Tágides, 1990-280",
    desc: "王子文去打过卡。晚餐加饮料差不多25€，摆盘精致，肉种类很多，大多是不带调味的。感觉有些肉是冷冻的，但这个价格还要啥自行车，很实惠了。我不吃牛舌，但朋友说葱牛舌很好吃。推荐台式香肠，带菠萝的肉，寿喜烧。不推荐关东煮，味道怪怪的。",
    img: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTdyphILAqiTyjG8yMbjStKAMNdtNl4BTVKRQ&s"
  },
  {
    name: "Sea Palace",
    lat: 38.76765866606877, 
    lng: -9.092234338029279,
    categories: ["中餐"],
    cost: "",
    address: "Passeio das Tágides Lote 2.25.01, Parque das Nações, 1990-280",
    desc: "",
    img: "https://lifecooler.com/files/registos/imagens/451632/361255.jpg"
  },
  {
    name: "The Old House",
    lat: 38.77041534775769, 
    lng: -9.092427262335926,
    categories: ["中餐"],
    cost: "",
    address: "R. da Pimenta 9, 1990-254 Lisboa",
    desc: "高端商务餐厅，大使馆的一些活动都会在那里办。味道不错，价格贵。",
    img: "https://tb-static.uber.com/prod/image-proc/processed_images/b90dd3a8e1b5d37b66c1945ab0f6b491/16bb0a3ab8ea98cfe8906135767f7bf4.jpeg"
  },
  {
    name: "Sushicome PQ.Nações (Sul)",
    lat: 38.76465738981018, 
    lng: -9.096445699772282,
    categories: ["日料", "自助"],
    cost: "晚餐17.9€",
    address: "R. Mar do Norte 1 Loja 7, 1990-083 Lisboa",
    desc: "凭学生卡有折扣",
    img: "https://cdn.shopify.com/s/files/1/0669/8552/5527/files/sushicome_expo.jpg?v=1751890241"
  },
  {
    name: "ZHANG LALA(Ramen Lanzhou)张拉拉兰州牛肉面",
    lat: 38.77188697746868, 
    lng: -9.092338606516785,
    categories: ["中餐"],
    cost: "10-15€",
    address: "PT Lisboa, R. da Pimenta 63, 1990-254",
    desc: "好吃，身边的人都很爱。",
    img: "https://menu.restaurantguru.com/m0/menu-Restaurant-ZHANG-LALA-Ramen-Lanzhou-e7y.jpg"
  },
  {
    name: "Bubble Time",
    lat: 38.77009562092994, 
    lng: -9.09244573068956,
    categories: ["奶茶"],
    cost: "4.1-6€",
    address: "R. da Pimenta 3, 1990-254 Lisboa",
    desc: "风景不错，老外挺喜欢的，不是很符合我的口味。",
    img: "https://tb-static.uber.com/prod/image-proc/processed_images/531fe6a55b81b745dc576cb62902591e/c9252e6c6cd289c588c3381bc77b1dfc.jpeg"
  },
  {
    name: "The Whale Tea (Parque das Nações)",
    lat:  38.76810863062003, 
    lng: -9.092201318155047,
    categories: ["奶茶"],
    cost: "5-10€",
    address: "Passeio das Tágides, 1990-280 Lisboa",
    desc: "好像是专门从台湾那边专门学过来的，有挺多特色饮品的。",
    img: "https://tb-static.uber.com/prod/image-proc/processed_images/09dbefbc55d3890010fc0dc7e815f3b1/3ac2b39ad528f8c8c5dc77c59abb683d.jpeg"
  },
  {
    name: "Mon Tea Portugal 萌",
    lat: 38.76869897792993,  
    lng: -9.099304389318869,
    categories: ["奶茶"],
    cost: "3.6-6€",
    address: "Av. Aquilino Ribeiro Machado F2, 1990-084 Lisboa",
    desc: "好喝，符合中国人的口味，超喜欢泰国奶茶。",
    img: "https://media-cdn.tripadvisor.com/media/photo-s/1b/82/04/2c/what-about-some-waffle.jpg"
  },
  {
    name: "Mr.Box Tea",
    lat:  38.7348619486019, 
    lng: -9.154007006074325,
    categories: ["奶茶"],
    cost: "3.9-5.4€",
    address: "Av. António Augusto de Aguiar 140B, 1050-021 Lisboa",
    desc: "",
    img: "https://media.timeout.com/images/105825502/image.jpg"
  },
];

/* ========= 自动生成分类按钮 ========= */
const categorySet = new Set();
shops.forEach(shop => shop.categories.forEach(c => categorySet.add(c)));
const categories = ["全部", ...categorySet];

/* ========= Marker + Popup 创建 ========= */
let markers = [];

function createMarker(shop) {
  let iconHtml = `<div class="custom-marker"><img src="${shop.img}"></div>`;
  let icon = L.divIcon({
    html: iconHtml,
    className: "",
    iconSize: [50, 50],
    iconAnchor: [25, 50]
  });

  let popupHtml = `
    <div class="popup-card">
      <img class="popup-img" src="${shop.img}">
      <div class="popup-title">${shop.name}</div>
      <div class="popup-cost">${shop.cost}</div>
      <div class="popup-address">${shop.address}</div>
      <div style="height:8px;"></div>
      <div class="popup-desc">${shop.desc}</div>
    </div>
  `;

  let m = L.marker([shop.lat, shop.lng], { icon }).bindPopup(popupHtml);
  m.on("click", () => highlightShop(shop.name));
  return m;
}

shops.sort((a,b) => a.name.localeCompare(b.name,'zh-Hans'));
shops.forEach(s => {
  s.marker = createMarker(s).addTo(map);
  markers.push(s.marker);
});

/* ========= 分类按钮 ========= */
let activeCat = "全部";
const catBar = document.getElementById("categoryBar");

categories.forEach(cat => {
  let btn = document.createElement("button");
  btn.className = "cat-btn" + (cat === "全部" ? " active" : "");
  btn.innerText = cat;
  btn.onclick = () => {
    activeCat = cat;
    document.querySelectorAll(".cat-btn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    updateDisplay();
  };
  catBar.appendChild(btn);
});

/* ========= 右侧列表显示 ========= */
function updateDisplay() {
  const list = document.getElementById("shopList");
  list.innerHTML = "";

  shops.forEach(s => {
    let visible = activeCat === "全部" || s.categories.includes(activeCat);
    if (visible) {
      s.marker.addTo(map);
    } else {
      map.removeLayer(s.marker);
    }

    if (visible) {
      let div = document.createElement("div");
      div.className = "shop-item";
      div.innerHTML = `<div class="shop-name">${s.name}</div>`;
      div.onclick = () => {
        map.flyTo([s.lat, s.lng], 16, { duration: 0.5 });
        s.marker.openPopup();
      };
      list.appendChild(div);
    }
  });
}

/* ========= Marker 点击右侧高亮 ========= */
function highlightShop(name) {
  document.querySelectorAll(".shop-item").forEach(item => {
    if (item.innerText.includes(name)) {
      item.style.background = "#e8f2ff";
    } else {
      item.style.background = "transparent";
    }
  });
}

updateDisplay();
</script>
</body>
</html>
